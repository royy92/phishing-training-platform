{% extends "training/base.html" %}
{% block content %}

<div class="container py-5 text-light">

  <h2 class="text-center mb-5 text-info fw-bold">ðŸ“Š Awareness Comparison by Category</h2>

  <!-- Overall bars -->
  <div class="mb-4">
    <h5 class="text-light mb-2 fw-semibold">Overall Awareness (First Scenario)</h5>
    <div class="progress" style="height: 22px; border-radius: 12px; background-color: #2a2a2a;">
      <div class="progress-bar bg-primary fw-bold"
           role="progressbar"
           style="width: {{ first_awareness }}%; transition: width 1s ease-in-out;"
           aria-valuenow="{{ first_awareness }}" aria-valuemin="0" aria-valuemax="100">
        {{ first_awareness }}%
      </div>
    </div>
  </div>

  <div class="mb-5">
    <h5 class="text-light mb-2 fw-semibold">Overall Awareness (Second Scenario)</h5>
    <div class="progress" style="height: 22px; border-radius: 12px; background-color: #2a2a2a;">
      <div class="progress-bar bg-success fw-bold"
           role="progressbar"
           style="width: {{ second_awareness }}%; transition: width 1s ease-in-out;"
           aria-valuenow="{{ second_awareness }}" aria-valuemin="0" aria-valuemax="100">
        {{ second_awareness }}%
      </div>
    </div>
  </div>

  <!-- TABLE 1 -->
  <h4 class="text-primary mb-3 fw-semibold">ðŸ§© First Scenario per Category</h4>
  <div class="table-responsive mb-5">
    <table class="table table-dark table-striped table-bordered text-center align-middle">
      <thead class="table-secondary text-dark">
        <tr>
          <th>Category</th>
          <th>Scenario</th>
          <th>Participants</th>
          <th>Runs</th>
          <th>Avg Score</th>
          <th>Awareness %</th>
        </tr>
      </thead>
      <tbody>
        {% for s in phase1_rows %}
        <tr>
          <td>{{ s.category }}</td>
          <td>{{ s.scenario }}</td>
          <td>{{ s.participants }}</td>
          <td>{{ s.runs }}</td>
          <td>{{ s.avg_score }}</td>
          <td class="{% if s.awareness_pct >= 80 %}text-success{% elif s.awareness_pct >= 50 %}text-warning{% else %}text-danger{% endif %}">
            {{ s.awareness_pct }}%
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-muted text-center">No data for first scenarios yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Chart 1 -->
  <h4 class="text-info mb-3 fw-semibold">ðŸ“ˆ First Scenario Awareness Chart</h4>
  <div class="bg-dark p-4 rounded shadow mb-5">
    <canvas id="chartFirst"></canvas>
  </div>

  <!-- TABLE 2 -->
  <h4 class="text-success mb-3 fw-semibold">ðŸ§© Second Scenario per Category</h4>
  <div class="table-responsive mb-5">
    <table class="table table-dark table-striped table-bordered text-center align-middle">
      <thead class="table-secondary text-dark">
        <tr>
          <th>Category</th>
          <th>Scenario</th>
          <th>Participants</th>
          <th>Runs</th>
          <th>Avg Score</th>
          <th>Awareness %</th>
        </tr>
      </thead>
      <tbody>
        {% for s in phase2_rows %}
        <tr>
          <td>{{ s.category }}</td>
          <td>{{ s.scenario }}</td>
          <td>{{ s.participants }}</td>
          <td>{{ s.runs }}</td>
          <td>{{ s.avg_score }}</td>
          <td class="{% if s.awareness_pct >= 80 %}text-success{% elif s.awareness_pct >= 50 %}text-warning{% else %}text-danger{% endif %}">
            {{ s.awareness_pct }}%
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-muted text-center">No data for second scenarios yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Chart 2 -->
  <h4 class="text-info mb-3 fw-semibold">ðŸ“ˆ Second Scenario Awareness Chart</h4>
  <div class="bg-dark p-4 rounded shadow">
    <canvas id="chartSecond"></canvas>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const chart1Labels = JSON.parse('{{ chart1_labels|safe|escapejs }}');
  const chart1Values = JSON.parse('{{ chart1_values|safe|escapejs }}');

  const chart2Labels = JSON.parse('{{ chart2_labels|safe|escapejs }}');
  const chart2Values = JSON.parse('{{ chart2_values|safe|escapejs }}');

  // Chart 1
  const ctx1 = document.getElementById("chartFirst");
  new Chart(ctx1, {
    type: "bar",
    data: {
      labels: chart1Labels,
      datasets: [{
        label: "First Scenario Awareness (%)",
        data: chart1Values
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { labels: { color: "#ddd" } },
        title: { display: true, text: "First Scenario Awareness per Category (%)", color: "#fff" }
      },
      scales: {
        x: { ticks: { color: "#aaa" } },
        y: { beginAtZero: true, max: 100, ticks: { color: "#aaa" } }
      }
    }
  });

  // Chart 2
  const ctx2 = document.getElementById("chartSecond");
  new Chart(ctx2, {
    type: "bar",
    data: {
      labels: chart2Labels,
      datasets: [{
        label: "Second Scenario Awareness (%)",
        data: chart2Values
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { labels: { color: "#ddd" } },
        title: { display: true, text: "Second Scenario Awareness per Category (%)", color: "#fff" }
      },
      scales: {
        x: { ticks: { color: "#aaa" } },
        y: { beginAtZero: true, max: 100, ticks: { color: "#aaa" } }
      }
    }
  });
</script>

{% endblock %}
