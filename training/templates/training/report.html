{% extends "training/base.html" %}
{% block content %}

<div class="container py-5 text-light">

  <h2 class="text-center mb-5 text-info fw-bold">ðŸ“Š Awareness Comparison by Category</h2>

  <!-- ðŸŸ¦ Awareness Bar - First Scenario -->
  <div class="mb-4">
    <h5 class="text-light mb-2 fw-semibold">First Scenario Awareness Level</h5>
    <div class="progress" style="height: 25px; border-radius: 12px; background-color: #2a2a2a;">
      <div class="progress-bar bg-primary fw-bold"
           role="progressbar"
           style="width: {{ first_awareness }}%; transition: width 1s ease-in-out;"
           aria-valuenow="{{ first_awareness }}" aria-valuemin="0" aria-valuemax="100">
        {{ first_awareness }}%
      </div>
    </div>
  </div>

  <!-- ðŸ”¹ First Scenario Section -->
  <h4 class="text-primary mb-3 fw-semibold">ðŸ§© First Scenario per Category</h4>
  <div class="table-responsive mb-5">
    <table class="table table-dark table-striped table-bordered text-center align-middle">
      <thead class="table-secondary text-dark">
        <tr>
          <th>Category</th>
          <th>Scenario</th>
          <th>Score</th>
          <th>Backs</th>
          <th>Nexts</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for s in first_data %}
        <tr>
          <td>{{ s.category }}</td>
          <td>{{ s.scenario }}</td>
          <td class="{% if s.score >= 4 %}text-success{% elif s.score >= 2 %}text-warning{% else %}text-danger{% endif %}">
            {{ s.score }}
          </td>
          <td>{{ s.backs }}</td>
          <td>{{ s.nexts }}</td>
          <td>{{ s.date }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-muted text-center">No data for first scenarios.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ðŸŸ© Awareness Bar - Second Scenario -->
  <div class="mb-4">
    <h5 class="text-light mb-2 fw-semibold">Second Scenario Awareness Level</h5>
    <div class="progress" style="height: 25px; border-radius: 12px; background-color: #2a2a2a;">
      <div class="progress-bar bg-success fw-bold"
           role="progressbar"
           style="width: {{ second_awareness }}%; transition: width 1s ease-in-out;"
           aria-valuenow="{{ second_awareness }}" aria-valuemin="0" aria-valuemax="100">
        {{ second_awareness }}%
      </div>
    </div>
  </div>

  <!-- ðŸ”¹ Second Scenario Section -->
  <h4 class="text-success mb-3 fw-semibold">ðŸ§© Second Scenario per Category</h4>
  <div class="table-responsive mb-5">
    <table class="table table-dark table-striped table-bordered text-center align-middle">
      <thead class="table-secondary text-dark">
        <tr>
          <th>Category</th>
          <th>Scenario</th>
          <th>Score</th>
          <th>Backs</th>
          <th>Nexts</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for s in second_data %}
        <tr>
          <td>{{ s.category }}</td>
          <td>{{ s.scenario }}</td>
          <td class="{% if s.score >= 4 %}text-success{% elif s.score >= 2 %}text-warning{% else %}text-danger{% endif %}">
            {{ s.score }}
          </td>
          <td>{{ s.backs }}</td>
          <td>{{ s.nexts }}</td>
          <td>{{ s.date }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-muted text-center">No data for second scenarios.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ðŸ”¹ Comparison Chart -->
  <h4 class="text-info mb-4 fw-semibold">ðŸ“ˆ Comparison Chart (First vs Second Scenario)</h4>
  <div class="bg-dark p-4 rounded shadow">
    <canvas id="compareChart"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const categories = JSON.parse('{{ chart_categories|safe|escapejs }}');
  const firstAwareness = JSON.parse('{{ chart_first_awareness|safe|escapejs }}');
  const secondAwareness = JSON.parse('{{ chart_second_awareness|safe|escapejs }}');

  if (categories.length === 0) {
    document.querySelector(".bg-dark").innerHTML = `
      <p class="text-center text-muted mt-4">No data available yet for comparison.</p>`;
  } else {
    const ctx = document.getElementById("compareChart");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: categories,
        datasets: [
          {
            label: "First Scenario Awareness",
            data: firstAwareness,
            backgroundColor: "#60a5fa"
          },
          {
            label: "Second Scenario Awareness",
            data: secondAwareness,
            backgroundColor: "#4ade80"
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: "Awareness Levels per Category (First vs Second Scenario)",
            color: "#fff"
          },
          legend: {
            labels: { color: "#ddd" }
          }
        },
        scales: {
          x: { ticks: { color: "#aaa" } },
          y: { beginAtZero: true, max: 5, ticks: { color: "#aaa" } }
        }
      }
    });
  }
</script>

{% endblock %}
